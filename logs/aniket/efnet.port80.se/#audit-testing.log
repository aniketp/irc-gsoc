[2018-04-24 15:02:14] * aniketp41 (~aniketp41@159.65.149.37) join
[2018-04-24 15:02:14] * efnet.port80.se mode +n
[2018-04-24 15:02:14] * efnet.port80.se mode +t
[2018-04-24 15:22:42] * somers_ (~somers@63-224-81-165.hlrn.qwest.net) join
[2018-04-24 22:58:37] <aniketp41> Hi Alan, am I supposed to get an email with FreeBSD for mailing list communication? The page here mentioned setting up the Project Wiki and Self page along with FreeBSD email address. https://wiki.freebsd.org/SummerOfCodeStudentChecklist
[2018-04-25 05:26:45] * somers__ (~somers@63-224-81-204.hlrn.qwest.net) join
[2018-04-25 05:28:39] * somers_ (~somers@63-224-81-165.hlrn.qwest.net) quit Ping timeout: 252 seconds
[2018-04-25 05:30:06] <aniketp41> Hi Alan, did you see the previous message before ping timeout?
[2018-04-25 19:22:29] <aniketp41> ping @somers__ 
[2018-04-25 19:24:26] <somers__> I don't know what you're "supposed" to get
[2018-04-25 19:24:29] <somers__> what are you expecting?
[2018-04-25 19:25:09] <somers__> BTW aniketp41, if you want to get my attention on IRC, you should mention my nick.  I sit in some high traffic rooms, so my client doesn't alert me unless my nick gets mentioned
[2018-04-25 20:25:21] <aniketp41> somers__ The checklist page mentioned about a username for SVN SummerOfCode repository which would also be used as the email, so I wonmdered if is it provided or would I need to create one for myself?
[2018-04-25 20:25:21] <aniketp41> Also, I have created a WikiPage "AniketPandey" and the page says to ask a FreeBSD developer to include my account in the Contributer's Group. So I was wondering if you could do that..
[2018-04-25 21:48:42] <aniketp41> ping somers__
[2018-04-25 22:02:48] <somers__> Ahh, to get your SVN account you'll have to email soc-admins@freebsd.org, as detailed at https://wiki.freebsd.org/SummerOfCodeSubversion
[2018-04-25 22:03:21] <somers__> Tell them you'll need a branch of the src tree
[2018-04-25 22:05:07] <somers__> Where is your "AniketPandey" wiki page?  I can't find it.
[2018-04-25 22:06:20] <aniketp41> Oh, guess it isn't created yet. I created my account but I can't create my page as I don't have the edit access.
[2018-04-25 22:08:40] <somers__> Ok, try again
[2018-04-25 22:32:33] <aniketp41> Thanks somers__ ! I created a basic page and would keep it updated throughout the project
[2018-04-25 22:32:33] <aniketp41> https://wiki.freebsd.org/AniketPandey
[2018-04-25 22:43:28] <aniketp41> Btw @somers__ , Would you advise on testing auditdistd(8) as well? A contributer Mateusz Piotrowski emailed me asking about it.
[2018-04-26 03:11:32] <somers__> aniketp41 I would consider auditdistd to be a stretch goal.  Testing the auditing itself is more important.
[2018-04-26 15:14:58] * somers__ (~somers@63-224-81-204.hlrn.qwest.net) quit Remote host closed the connection
[2018-04-26 16:07:57] * somers (~somers@2602:3f:e051:cc00:e23f:49ff:fe44:d7b6) join
[2018-04-26 23:07:07] * somers_ (~somers@63-224-81-240.hlrn.qwest.net) join
[2018-04-26 23:08:35] * somers (~somers@2602:3f:e051:cc00:e23f:49ff:fe44:d7b6) quit Ping timeout: 252 seconds
[2018-04-27 00:40:28] <aniketp41> Hi @somers_, Does your work at Spectra involve FreeBSD? I was just curious. As I've noticed that quite a few FreeBSD devs contribute to it as a part-time hobby, while others use it at work. 
[2018-04-27 13:08:39] * somers__ (~somers@63-224-80-23.hlrn.qwest.net) join
[2018-04-27 13:09:14] <somers__> Yeah, Spectra's products run on FreeBSD
[2018-04-27 13:10:49] * somers_ (~somers@63-224-81-240.hlrn.qwest.net) quit Ping timeout: 252 seconds
[2018-04-27 16:15:36] * somers_ (~somers@63-224-80-107.hlrn.qwest.net) join
[2018-04-27 16:17:49] * somers__ (~somers@63-224-80-23.hlrn.qwest.net) quit Ping timeout: 252 seconds
[2018-04-29 13:36:29] <aniketp41> Hi @somers_, I mailed the soc-admins about getting a subversion account and a branch in socsvn repository. Also, my semester exams ended today so I'll regularly update you on my work from now on
[2018-04-29 13:39:32] * rwatson (robert@fledge.watson.org) join
[2018-04-29 14:04:21] <somers_> cool
[2018-04-29 14:47:36] <aniketp41> Btw @somers_, how much time does it take to "buildworld" the freebsd kernel by a single job? I was trying to build my tests by compiling the "/usr/src" and its been running for the last 10 minutes..
[2018-04-29 14:48:25] <aniketp41> Although I later realized that the guide here https://www.freebsd.org/doc/handbook/makeworld.html recommended four jobs (-j4)
[2018-04-29 14:48:38] <somers_> Depends on what kind of machine you have.  "buildworld" can take anywhere from 10 minutes to 2.5 hours on typical hardware
[2018-04-29 14:49:00] <somers_> But once you've built it once, you can do "make -DNO_CLEAN buildworld" on subsequent invocations
[2018-04-29 14:51:30] <somers_> The number of jobs should be at least equal to the number of CPU cores.  If you're I/O is slow, then use up to 2x number of cores for your job number
[2018-04-29 14:51:33] <aniketp41> I created a separate VM for specifically this task and it does not have very good specs. so by what you said it might take a long time
[2018-04-29 14:51:39] <somers_> Is your source directory mounted over NFS?
[2018-04-29 14:52:46] <aniketp41> No it is simple UFS
[2018-04-29 14:53:24] <somers_> Ok, that's fine then.  Just give your VM as much CPU and RAM as you can, set the jobs number appropriately, and wait.
[2018-04-29 15:04:37] <aniketp41> Wow, it's building quite fast, my main machine had 8 cores and 16 gigs of ram which allowed me to allocate 4 cores and about 10 gigs to my VM. With 8 jobs it's doing well!
[2018-04-29 15:05:04] <somers_> cool!  What kind of storage does it have?
[2018-04-29 15:09:43] <aniketp41> I think its HDD, although the Virtualbox showed an option to have an SSD partition
[2018-04-29 15:10:07] <somers_> What's important is the physical device, not how VirtualBox displays it
[2018-04-29 15:10:20] <aniketp41> Though my main machine has 256 gigs SSD
[2018-04-29 15:10:52] <somers_> If you have SSD storage and 4 cores, then 8 build jobs is too many.  Just use 5-6
[2018-04-29 15:15:56] <aniketp41> Okay, I'll keep it in mind the next time I try building the kernel
[2018-04-29 15:53:04] <aniketp41> So it took 46 minutes approx to buildworld. Now doing buildkernel with 6 jobs now
[2018-04-30 00:36:54] <aniketp41> Hi @somers_, I was reading about non-blocking sockets for testing network APIs as you suggested in a previous mail. But I couldn't come up with any idea about how this would help me in writing the test program. For instance, to have all system calls in one place, I'll need to have both client and server running in the single program, but how would using non-blocking socket help me? AFAIK it would just prevent accept(2), recv(2) from blocking the connection. 
[2018-04-30 00:42:38] <aniketp41> I also had another idea about the approach that I might follow. Till now I've been testing the file-create/read audit_events independently, so what if I use the same approach for network system calls that don't need a client (or a server, the other way), like socket(2), bind(2), setsockopt(2), listen(2) etc. Once I've confirmed their audit, I can simply close the socket as I don't really need a connection here.
[2018-04-30 00:42:38] <aniketp41> As for syscalls like accept(2), connect(2), send(2), recv(2) etc, that need a connection, I can have a separate binary which I can execute using system(3) and them call the syscall from my kyua test-case, and finally poll into auditpipe(4) to check if that particular syscall is audited or not? This approach is a bit weird since I will need external socket-programs, but might actually work! Please provide your inputs for this.. 
[2018-04-30 03:42:12] * somers_ (~somers@63-224-80-107.hlrn.qwest.net) quit Read error: Connection reset by peer
[2018-04-30 03:43:37] * somers_ (~somers@63.224.80.107) join
[2018-04-30 03:44:09] * somers_ (~somers@63.224.80.107) quit Remote host closed the connection
[2018-04-30 03:45:41] * somers_ (~somers@63-224-80-107.hlrn.qwest.net) join
[2018-04-30 06:14:38] * somers__ (~somers@63-224-80-93.hlrn.qwest.net) join
[2018-04-30 06:16:56] * somers_ (~somers@63-224-80-107.hlrn.qwest.net) quit Ping timeout: 252 seconds
[2018-04-30 07:37:37] * somers_ (~somers@63-224-81-79.hlrn.qwest.net) join
[2018-04-30 07:39:47] * somers__ (~somers@63-224-80-93.hlrn.qwest.net) quit Ping timeout: 252 seconds
[2018-04-30 13:47:25] <aniketp41> ping @somers_
[2018-04-30 14:08:34] <somers_> I don't think you should use external helper programs
[2018-04-30 14:09:25] <somers_> All of the networking syscalls should be testable using a single thread, with nonblocking sockets
[2018-04-30 14:09:35] <somers_> Is there one in particular that you're having trouble with?
[2018-04-30 14:13:08] <aniketp41> So like if I have a server with non-blocking socket, how would I connect(2) using the client? I'm not sure how I would put the client within the same program.
[2018-04-30 14:15:18] <somers_> The "server" would set its socket to be nonblocking, and call listen.  Then the "client" would set its end to nonblocking, and call connect.  Finally, the "server" would call accept.
[2018-04-30 14:16:09] <somers_> I'm not sure if the connect call would succeed, or return EINPROGRESS.  I think it would succeed as long as the socket is listening.
[2018-04-30 15:26:14] <aniketp41> Hi @somers_, The method you suggested worked. I followed the same pattern, server->listen, client->connect, server->accept and all the basic network APIs were audited
[2018-04-30 15:26:16] <aniketp41> https://pastebin.com/Pp3wBMCV
[2018-04-30 15:26:45] <aniketp41> Please ignore the formatting as I'll improve it in the formal program!
[2018-04-30 15:28:31] <aniketp41> Audit result: https://pastebin.com/g15LQ9gM
[2018-04-30 15:31:03] <aniketp41> But on my Linux main machine it returns EINPROGRESS: Connect error: Operation now in progress
[2018-04-30 16:20:18] <aniketp41> @somers_, would polling be a solution for EINPROGRESS issue here? Although this this did not happen in my FreeBSD machine, but it did in Linux 
[2018-04-30 16:26:53] <aniketp41> Also, @somers_, @rwatson,  I was testing unlink(2) and unlinkat(2) system call which is under "ad": administrative audit_class but the audit was unsuccessful on setting "ad" as the audit flag while on setting the flag as "all", it was successful  
[2018-04-30 16:27:12] <aniketp41> Is "ad" really the audit_class for unlink(at)(2)?
[2018-04-30 16:27:49] <aniketp41> Oh sorry its fd, my mistake!
[2018-04-30 18:13:46] <aniketp41> ping @somers_
[2018-04-30 18:27:30] <somers_> Yes?
[2018-04-30 18:31:56] <somers_> @aniketp41 in your connect test, it looks like the client is trying to connect to 0.0.0.0:9000.  I'm not even sure what it means to connect to 0.0.0.0.  Your results might be more portable if it connects to 127.0.0.1
[2018-04-30 18:35:36] <somers_> But the error on Linux probably means that the connection attempt is in progress, and you should use select(2) to know when it's complete
[2018-04-30 18:57:13] <aniketp41> Yes @somers_, I think I'll have to change this "server.sin_addr.s_addr = "INADDR_ANY" to "inet_addr("127.0.0.1")"
[2018-04-30 19:03:15] <aniketp41> It might have been trying to connect to all available interfaces (i.e 0.0.0.0)
[2018-05-01 03:19:56] * gnn (~quassel@f373.x.rootbsd.net) join
[2018-05-01 03:20:03] <gnn> aniketp41: Hello.
[2018-05-01 08:28:56] <aniketp41> Hello @gnn, thanks for joining the channel!
[2018-05-01 10:37:03] * aniketp41 (~aniketp41@159.65.149.37) join
[2018-05-01 16:18:52] <aniketp41> Hi @gnn, I'm working in the organization of files in the test-suite as I arranged it as such before I started creating Kyua test-cases. 
[2018-05-01 21:38:02] <aniketp41> Hi @somers_, how did you compile the Kyua test-program that I shared with you once? 
[2018-05-01 21:38:02] <aniketp41> I'm currently having a trouble with linking the <atf-c.h> header with the main program
[2018-05-01 21:38:22] <aniketp41> Here is the link to the error produced https://pastebin.com/La8Wvexh
[2018-05-01 21:39:16] <aniketp41> I tried compiling with the example shown here https://github.com/jmmv/kyua/wiki/Quickstart-atf-c-test#atf_tests2c---test-program-with-multiple-test-cases but it doesn't seem to work
[2018-05-01 21:41:28] <somers_> @aniketp41 I put the program in tests/sys/audit and wrote this to tests/sys/audit/Makefile:
[2018-05-01 21:41:45] <somers_> ESTSDIR=       ${TESTSBASE}/sys/audit
[2018-05-01 21:41:45] <somers_> ATF_TESTS_C+=   mkdir-atf0
[2018-05-01 21:41:45] <somers_> TEST_METADATA.mkdir-atf0+= timeout="30"
[2018-05-01 21:41:45] <somers_> CFLAGS+=        -I${.CURDIR:H:H}
[2018-05-01 21:41:45] <somers_> WARNS?= 6
[2018-05-01 21:41:46] <somers_> .include <bsd.test.mk>
[2018-05-01 21:46:00] <aniketp41> Yes I followed a similar makeshift procedure of putting the tests in /usr/src/sbin/devd/tests and replaced the content of its Makefile to test mkdir-atf0.c instead of client-test.c and it worked.
[2018-05-01 21:46:00] <aniketp41> But now that I'm trying to separate the setup functions in a separate C file so that I can share it with multiple test programs but I'm unable to link it properly. Can you suggest me a way to do so?
[2018-05-01 21:46:20] <aniketp41> Possibly making some modifications to the Makefile?
[2018-05-01 21:48:49] <somers_> So you want to build a single binary from two .c files?  Then you need to specify the SRCS variable.  Take a look at sys/geom/class/eli/Makefile
[2018-05-01 21:49:03] <somers_> err, tests/sys/geom/class/eli/Makefile
[2018-05-01 21:55:24] <aniketp41> @somers_, is there supposed to be a Makefile in the test-suite? I only found a bunch of tests and a Kyuafile.. 
[2018-05-01 21:55:39] <aniketp41> at /usr/tests/sys/geom/class/eli
[2018-05-01 21:55:49] <somers_> I'm talking about the source directory
[2018-05-02 01:51:16] <aniketp41> @somers_, using the Makefile you provided was giving quite a lot of errors which I didn't get before, some of them referenced no extern declaration for non-static global variables, which made sense. But a lot of the other errors should've been a warning (shadowing global scope) unless its too strict. Here is the list: https://pastebin.com/wPAxNJat
[2018-05-02 02:37:41] <aniketp41> Hi @somers_, I made a few changes to remove all the errors, please have a look at the changes and suggest any improvements https://github.com/aniketp/AuditTestSuite/commit/b456c15c7dc2a8728b764f49d8429fbee8fb37f9
[2018-05-02 02:37:46] <somers_> Yeah, those are all errors in your code.
[2018-05-02 02:38:36] <somers_> We should switch from reviewing on Github to using Phabricator, now that you've got a full src tree setup
[2018-05-02 02:38:59] <somers_> https://wiki.freebsd.org/Phabricator
[2018-05-02 02:42:33] <aniketp41> src tree setup in socsvn repository branch? I didn't receive any notification about it..
[2018-05-02 02:43:22] <somers_> Do you have an svn account yet?  You can create the branch yourself if so
[2018-05-02 03:00:22] <aniketp41> I don't think I have an SVN account yet, was waiting for confirmation from the soc-admins. But I had created an account earlier in FreeBSD's Phabricator. i.e https://reviews.freebsd.org/
[2018-05-02 03:40:01] <aniketp41> Btw @somers_, adding SRCS+=filename.c to the above Makefile do the job?
[2018-05-02 03:40:13] <aniketp41> *will adding
[2018-05-02 03:41:45] <somers_> try it and see
[2018-05-02 09:04:11] * somers_ (~somers@63-224-81-79.hlrn.qwest.net) quit Remote host closed the connection
[2018-05-02 09:05:40] * somers_ (~somers@63-224-81-79.hlrn.qwest.net) join
[2018-05-02 12:21:20] <aniketp41> @somers_, @gnn Generally how long does it take to get a reply back from soc-admins@ ? I'm unable to setup my svn work-area as I don't have an account yet!
[2018-05-02 14:08:10] <aniketp41> Hi @somers_, I've been trying to separate the setup functions from main test program and tried to modify the Makefile to include "SRCS+=setup". But from the errors it seems that the test-program is not able to identify the function declaration in setup.h https://pastebin.com/1CyZii70
[2018-05-02 14:08:46] <aniketp41> Here is the directory organisation within usr/src/tests/sys/audit: https://github.com/aniketp/AuditTestSuite/tree/restructure/src
[2018-05-02 14:16:49] <somers_> you simply forgot to include setup.h in setup.c
[2018-05-02 14:18:48] <aniketp41> Oops, right! Correcting it now
[2018-05-02 14:21:22] <aniketp41> Now it's giving me a bunch of linker errors (same as what I got when I tried independently compiling the tests). Maybe there is an issue with my Makefile, I guess?
[2018-05-02 14:21:22] <aniketp41> Most of the linker error is like this: "undefined reference to `atf_tc_<some-api>"
[2018-05-02 14:22:08] <aniketp41> https://pastebin.com/R7t1JXJw
[2018-05-02 14:23:06] <somers_> Try "SRCS.file-create+=setup" in your Makefile
[2018-05-02 14:26:08] <aniketp41> @somers_, similar error again :/
[2018-05-02 14:26:39] <aniketp41> Is it not able to link to atf-c.h?
[2018-05-02 14:27:06] <somers_> You don't link to header files.  Show me your Makefile and error message
[2018-05-02 14:31:39] <aniketp41> Here is the Makefile: https://github.com/aniketp/AuditTestSuite/blob/restructure/src/Makefile
[2018-05-02 14:31:39] <aniketp41> And the error message after modifying the Makefile: https://pastebin.com/XNABQ9V0
[2018-05-02 14:33:33] <somers_> then try explicitly setting all of SRCS.  "SRCS.file-create=file-create.c setup.c"
[2018-05-02 15:38:45] <gnn> aniketp41: Should be a day or so.
[2018-05-02 15:38:55] <gnn> If more than that email again and cc me again and I'll talk to them.
[2018-05-02 15:39:02] <gnn> They are, as most of us, overworked.
[2018-05-02 16:38:04] <aniketp41> Hi @somers_, I made the change in Makefile, "SRCS.file-create=file-create.c setup.c". The linker issue was gone but it also generated a bunch of new errors. Some of them weirdly pointing to implicit declaration of ATF_TC_* functions. 
[2018-05-02 16:38:04] <aniketp41> Here is the error log: https://pastebin.com/FVBZq4vn
[2018-05-02 16:38:04] <aniketp41> And the code: https://github.com/aniketp/AuditTestSuite/tree/restructure/src
[2018-05-02 16:39:11] <somers_> You forgot to include atf.h
[2018-05-02 16:41:05] <aniketp41> Ohh, I included it in the wrong file again. It should be in file-create.c instead of setup.c. Thanks!
[2018-05-02 16:47:48] <aniketp41> @somers_, Is it alright that I move all includes in setup.h seeing all the fuss which is being created?
[2018-05-02 16:47:48] <aniketp41> Btw the tests are passing again!
[2018-05-02 16:48:37] <somers_> Header bloat is frowned upon.  In FreeBSD, the convention is for file to #include only what it needs.
[2018-05-02 16:50:23] <aniketp41> Okay then I'll have a careful look at what is needed where and move the includes appropriately..
[2018-05-02 17:07:04] <aniketp41> @somers_, I made the appropriate changes in inclusions: Please have a look the current code: https://github.com/aniketp/AuditTestSuite/tree/restructure/src
[2018-05-02 17:09:15] <aniketp41> Also, according to the list of audit_events corresponding to audit_class (fc: file-create), I've made basic test-cases for all 12 syscalls in both failure mode. Shall I create a differential once I get my svn account?
[2018-05-02 17:09:15] <aniketp41> Unless you want me to test some other functionalities of "fc" audit_class before I move on to other classes?
[2018-05-02 17:09:36] <aniketp41> *in both failure and success mode
[2018-05-02 17:09:58] <somers_> please do
[2018-05-02 18:21:00] * somers (~somers@63-224-80-52.hlrn.qwest.net) join
[2018-05-02 18:21:59] * somers_ (~somers@63-224-81-79.hlrn.qwest.net) quit Ping timeout: 252 seconds
[2018-05-02 19:44:46] * somers_ (~somers@63-224-81-246.hlrn.qwest.net) join
[2018-05-02 19:51:12] * somers (~somers@63-224-80-52.hlrn.qwest.net) quit Read error: Operation timed out
[2018-05-03 17:59:47] <aniketp41> Hi @somers_, shall I simply add these files to tests/sys/audit (including the Makefile) while creating a differential? I'm working with a fork of https://github.com/freebsd/freebsd
[2018-05-03 18:00:16] <aniketp41> https://github.com/aniketp/AuditTestSuite/tree/master/src
[2018-05-03 19:39:35] <aniketp41> Ping @somers_
[2018-05-03 20:12:42] <somers_> Yeah, you can add files in a differential revision
[2018-05-03 22:09:30] <aniketp41> Hi @somers_, I created a diff here: https://reviews.freebsd.org/D15286. Please have look. And since this is my first review, please do point out if I messed up somewhere!  
[2018-05-04 15:22:40] <aniketp41> @somers_, what should we do about the non-root issue, since auditpipe does not seem to work here?
[2018-05-04 15:23:35] <somers_> Have you seen anything in the docs about auditing as a non-root user?  Presumably you would be restricted to auditing your own events only.
[2018-05-04 15:30:30] <aniketp41> The doc here https://www.freebsd.org/doc/handbook/audit-administration.html#idp69949288 mentions that the audit trails and the auditpipe(4) is available to the group "audit". I was able to pass the tests when I added myself to that group. Apart from that, I couldn't find any way to access audit facility as a normal user..
[2018-05-04 15:37:06] <somers_> Well, you can certainly skip the tests on the basis of group membership
[2018-05-04 15:37:53] <somers_> Actually, the stuff in /var/audit looks like it's available to group audit, but /dev/auditpipe is only available to root
[2018-05-04 15:43:28] <aniketp41> Oh apologies, the tests produced the same results (bad file descriptor) from audit group too, I guess I must've run the tests as root user, that's how it must have passed (I have SSHd into my VM from two windows, one as root, other as a normal user, so might have inverted the test windows :D )
[2018-05-04 15:43:28] <aniketp41> So, for now, shall I skip the tests for non-root users?
[2018-05-04 15:43:55] <aniketp41> Since no group can actually access /dev/auditpipe..
[2018-05-04 15:44:14] <somers_> Yeah.  Just like you do for the mknod test
[2018-05-04 16:27:24] <aniketp41> Hi @somers_, please have a look at the changes, https://reviews.freebsd.org/D15286
